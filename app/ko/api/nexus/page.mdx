---
title: nexus
description: 서버에서 하이드레이션/재시도/타임아웃/인터셉터를 포함한 데이터 패칭.
---

# nexus

임포트:
```ts path=null start=null
import { withNexusHydrationBoundary, nexus } from 'next-nexus/server'
```

## 시그니처
```ts path=null start=null
nexus<T>(definition: NexusDefinition<T>): Promise<NexusResponse<T>>
```

## 예제

레이아웃이 없는 세그먼트에서 HOC 사용:
```tsx path=null start=null
// app/(shop)/products/page.tsx
import { withNexusHydrationBoundary, nexus } from 'next-nexus/server'
import { productDefinition } from '@/api/productDefinition'

async function ProductsPage() {
  const { data: products, headers } = await nexus(productDefinition.list)
  const total = headers.get('x-total-count')
  return (
    <div>
      <h1>상품 목록 ({total ?? 'n/a'})</h1>
      <ul>{products?.map(p => <li key={p.id}>{p.name}</li>)}</ul>
    </div>
  )
}

export default withNexusHydrationBoundary(ProductsPage)
```

인증 인터셉터와 다중 요청:
```tsx path=null start=null
// app/(shop)/dashboard/page.tsx
import { withNexusHydrationBoundary, nexus } from 'next-nexus/server'
import { productDefinition } from '@/api/productDefinition'
import { createDefinition } from '@/api/nexusDefinition'

const stats = createDefinition<{ users: number; orders: number }>({
  method: 'GET', endpoint: '/stats', interceptors: ['auth'],
  server: { revalidate: 300, tags: ['stats'] },
})

async function DashboardPage() {
  const [productsRes, statsRes] = await Promise.all([
    nexus(productDefinition.list),
    nexus(stats),
  ])
  return (
    <div>
      <h2>지표: 사용자 {statsRes.data?.users} / 주문 {statsRes.data?.orders}</h2>
      <ul>{productsRes.data?.map(p => <li key={p.id}>{p.name}</li>)}</ul>
    </div>
  )
}

export default withNexusHydrationBoundary(DashboardPage)
```

타임아웃/재시도(초 단위):
```ts path=null start=null
const slowReport = createDefinition<{ ok: boolean }>({
  method: 'GET', endpoint: '/report', timeout: 8, retry: { count: 2, delay: 2 },
})
```

뮤테이션 이후 태그 재검증(클라이언트 컴포넌트):
```tsx path=null start=null
'use client'
import { revalidateClientTags } from 'next-nexus/client'
import { revalidateServerTags } from 'next-nexus'

async function onSuccess() {
  await revalidateServerTags(['products'])
  revalidateClientTags(['products'])
}
```

## Definition 옵션(개요)
- method: 'GET' | 'POST' | 'PUT' | 'PATCH' | 'DELETE'
- endpoint: 문자열 (예: '/products')
- baseURL?: 문자열 (endpoint 앞에 붙음)
- headers?: HeadersInit (병합; 문자열 'null'|'undefined'는 해당 헤더 삭제)
- server?: `{ cache?: RequestCache; revalidate?: number; tags?: string[] }`
- client?: `{ revalidate?: number; tags?: string[]; cachedHeaders?: string[] }`
- timeout?: number (초)
- retry?: `{ count: number; delay?: number }`
- interceptors?: string[] (전역 등록 이름)

### 기본값
- `server.cache` 생략 시 기본은 `no-store`입니다. 정적 캐싱/ISR이 필요한 경우에만 `server.cache: 'force-cache'`를 명시하세요.

